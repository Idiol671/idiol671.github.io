<div id="camera-wrapper">
  <!-- Камера -->
  <video id="cam" autoplay muted playsinline></video>

  <!-- Модель — ВСЕГДА видна и управляемая -->
  <model-viewer
    id="model"
    src="./assets/horse_elements/SM_horse.gltf"
    camera-controls
    disable-zoom
    ar
    ar-modes="webxr scene-viewer quick-look"
    style="pointer-events: auto">
  </model-viewer>

  <!-- Фильтр -->
  <img class="overlay" id="filter1" src="/assets/ice-1.png" />
</div>

<script>
  const video = document.getElementById("cam");

  async function initCamera() {
    try {
      let stream;

      // Сначала пробуем exact основной камеры
      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: {facingMode: {exact: "environment"}},
          audio: false,
        });
      } catch (e) {
        // fallback если exact не работает
        stream = await navigator.mediaDevices.getUserMedia({
          video: {facingMode: "environment"},
          audio: false,
        });
      }

      video.srcObject = stream;
    } catch (error) {
      console.error("Ошибка камеры:", error);
    }
  }

  initCamera();
</script>

<style>
  #camera-wrapper {
    position: relative;
    width: min(90vw, 640px);
    aspect-ratio: 3/4;
    overflow: hidden;
    border-radius: 24px;
  }

  #camera-wrapper > * {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #cam {
    z-index: 1;
  }

  model-viewer {
    z-index: 2;
    background: transparent;
  }

  .overlay {
    z-index: 3;
    pointer-events: none;
    mix-blend-mode: screen;
  }
</style>
